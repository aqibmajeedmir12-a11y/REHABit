<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>HabitAI ‚Äî Full App</title>
<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
<!-- App Styles -->
<link rel="stylesheet" href="css/style.css">
</head>
<body>

<!-- ‚îÄ‚îÄ‚îÄ AUTH SCREEN ‚îÄ‚îÄ‚îÄ -->
<div class="auth-screen" id="auth-screen">
  <div class="auth-particles-wrap" id="auth-particles"></div>
  <div class="auth-card">
    <div class="auth-logo">
      <div class="auth-logo-icon">‚ö°</div>
      <div class="auth-logo-text"><span>Habit</span>AI</div>
    </div>

    <div class="auth-tabs">
      <div class="auth-tab active" id="tab-login" onclick="switchAuthTab('login')">Sign In</div>
      <div class="auth-tab" id="tab-register" onclick="switchAuthTab('register')">Create Account</div>
    </div>

    <!-- LOGIN FORM -->
    <div class="auth-form active" id="form-login">
      <div class="auth-error" id="login-error">Invalid email or password.</div>
      <div class="auth-input-wrap">
        <i class="fa fa-envelope"></i>
        <input class="auth-input" id="login-email" type="email" placeholder="Email address" autocomplete="email">
      </div>
      <div class="auth-input-wrap">
        <i class="fa fa-lock"></i>
        <input class="auth-input" id="login-pass" type="password" placeholder="Password" autocomplete="current-password">
      </div>
      <button class="auth-btn" onclick="doLogin()">
        <i class="fa fa-arrow-right-to-bracket"></i> Sign In
      </button>
      <div class="auth-divider">or continue with</div>
      <div class="auth-social">
        <button class="auth-social-btn" onclick="doSocialLogin('Google')">üåê Google</button>
        <button class="auth-social-btn" onclick="doSocialLogin('Apple')">üçé Apple</button>
      </div>
    </div>

    <!-- REGISTER FORM -->
    <div class="auth-form" id="form-register">
      <div class="auth-error" id="reg-error">Please fill all fields.</div>
      <div class="auth-input-wrap">
        <i class="fa fa-user"></i>
        <input class="auth-input" id="reg-name" type="text" placeholder="Your full name" autocomplete="name">
      </div>
      <div class="auth-input-wrap">
        <i class="fa fa-envelope"></i>
        <input class="auth-input" id="reg-email" type="email" placeholder="Email address" autocomplete="email">
      </div>
      <div class="auth-input-wrap">
        <i class="fa fa-lock"></i>
        <input class="auth-input" id="reg-pass" type="password" placeholder="Create password"
          autocomplete="new-password" oninput="checkStrength(this.value)">
      </div>
      <div class="strength-bar-w"><div class="strength-bar" id="strength-bar"></div></div>
      <div class="strength-label" id="strength-label">Password strength</div>
      <button class="auth-btn" onclick="doRegister()">
        <i class="fa fa-rocket"></i> Create Account
      </button>
      <div class="auth-divider">or continue with</div>
      <div class="auth-social">
        <button class="auth-social-btn" onclick="doSocialLogin('Google')">üåê Google</button>
        <button class="auth-social-btn" onclick="doSocialLogin('Apple')">üçé Apple</button>
      </div>
    </div>

  </div>
</div><!-- /auth-screen -->

<!-- ‚îÄ‚îÄ‚îÄ APP SHELL ‚îÄ‚îÄ‚îÄ -->
<div class="app">

  <!-- ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ -->
  <div class="sidebar">
    <div class="logo">
      <div class="logo-icon">‚ö°</div>
      <div class="logo-text"><span>Habit</span>AI</div>
    </div>

    <div class="nav-section">Main</div>
    <div class="nav-item active" data-page="dashboard">
      <i class="fa fa-home"></i><span>Dashboard</span>
    </div>
    <div class="nav-item" data-page="habits">
      <i class="fa fa-list-check"></i><span>Habits</span>
      <span class="nav-badge" id="sideHabitCount">6</span>
    </div>
    <div class="nav-item" data-page="analytics">
      <i class="fa fa-chart-line"></i><span>Analytics</span>
    </div>
    <div class="nav-item" data-page="insights">
      <i class="fa fa-brain"></i><span>AI Insights</span>
      <span class="nav-badge">3</span>
    </div>
    <div class="nav-item" data-page="achievements">
      <i class="fa fa-trophy"></i><span>Achievements</span>
    </div>

    <div class="nav-section">Plan</div>
    <div class="nav-item" data-page="schedule">
      <i class="fa fa-calendar"></i><span>Schedule</span>
    </div>
    <div class="nav-item" data-page="calendar">
      <i class="fa fa-calendar-days"></i><span>Calendar</span>
    </div>
    <div class="nav-item" data-page="settings">
      <i class="fa fa-gear"></i><span>Settings</span>
    </div>

    <div class="sidebar-footer">
      <div class="user-card">
        <div class="user-avatar">AJ</div>
        <div>
          <div class="user-name">Alex Johnson</div>
          <div class="user-level">‚≠ê Level <span id="sideLevel">7</span> ¬∑ Achiever</div>
        </div>
        <div class="icon-btn" style="margin-left:auto;width:30px;height:30px" title="Sign out" onclick="doLogout()">
          <i class="fa fa-right-from-bracket" style="font-size:12px"></i>
        </div>
      </div>
    </div>
  </div><!-- /sidebar -->

  <!-- ‚îÄ‚îÄ‚îÄ MAIN CONTENT ‚îÄ‚îÄ‚îÄ -->
  <div class="main">

    <!-- TOP NAVBAR -->
    <div class="navbar">
      <div class="navbar-left">
        <h1 id="pageTitle">AI Habit Intelligence Dashboard</h1>
        <p id="pageDate"></p>
      </div>
      <div class="navbar-right">
        <div class="icon-btn" onclick="goTo('settings')">
          <i class="fa fa-bell"></i><div class="notif-dot"></div>
        </div>
        <div class="icon-btn" title="Search (Ctrl+K)" onclick="showToast('üîç Search coming soon!')">
          <i class="fa fa-search"></i>
        </div>
        <button class="btn btn-primary" onclick="openModal()">
          <i class="fa fa-plus"></i> New Habit
        </button>
      </div>
    </div>

    <!-- ‚îÄ‚îÄ‚îÄ PAGE CONTENT ‚îÄ‚îÄ‚îÄ -->
    <div class="page-content" id="page-content-wrapper">
      <!-- Pages injected here by JavaScript -->
    </div>

  </div><!-- /main -->
</div><!-- /app -->

<!-- ‚îÄ‚îÄ‚îÄ ADD HABIT MODAL ‚îÄ‚îÄ‚îÄ -->
<div class="overlay" id="overlay" onclick="closeModalOut(event)">
  <div class="modal">
    <div class="modal-title">‚ûï <span id="modal-title-text">Add New Habit</span></div>
    <div class="modal-sub" id="modal-sub-text">Build a new routine, one day at a time.</div>

    <div class="form-group">
      <label class="form-label">Habit Name</label>
      <input class="form-input" id="h-name" placeholder="e.g. Morning meditation...">
    </div>

    <div class="form-group">
      <label class="form-label">Category</label>
      <select class="form-select" id="h-cat">
        <option value="Mind">Mind</option>
        <option value="Health">Health</option>
        <option value="Fitness">Fitness</option>
        <option value="Learn">Learn</option>
        <option value="Custom">Custom</option>
      </select>
    </div>

    <div class="form-group">
      <label class="form-label">Time</label>
      <input class="form-input" id="h-time" placeholder="e.g. 7:00 AM">
    </div>

    <div class="form-group">
      <label class="form-label">Choose Days</label>
      <div id="day-picker" style="display:flex;gap:6px;flex-wrap:wrap;">
        <div class="day-btn" data-day="0">Mon</div>
        <div class="day-btn" data-day="1">Tue</div>
        <div class="day-btn" data-day="2">Wed</div>
        <div class="day-btn" data-day="3">Thu</div>
        <div class="day-btn" data-day="4">Fri</div>
        <div class="day-btn" data-day="5">Sat</div>
        <div class="day-btn" data-day="6">Sun</div>
      </div>
    </div>

    <div class="form-group">
      <label class="form-label">Icon</label>
      <div class="emoji-row" id="ep-row"></div>
    </div>

    <div class="form-group">
      <label class="form-label">Color</label>
      <div class="color-row" id="cp-row"></div>
    </div>

    <div class="modal-actions">
      <button class="btn btn-ghost" style="flex:1" onclick="closeModal()">Cancel</button>
      <button class="btn btn-primary" style="flex:2" onclick="submitHabit()">
        <i class="fa fa-plus"></i> <span id="modal-btn-text">Add Habit</span>
      </button>
    </div>
  </div>
</div><!-- /overlay -->

<!-- ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ -->
<div class="toast" id="toast">
  <span id="toast-icon">üéâ</span>
  <span id="toast-msg">Done!</span>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
     SCRIPTS ‚Äî load order matters
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- 1. Shared state, utils, auth, router, settings -->
<script src="js/common.js"></script>
<!-- 2. Page-specific renderers -->
<script src="js/dashboard.js"></script>
<script src="js/habits.js"></script>
<script src="js/analytics.js"></script>
<script src="js/insights.js"></script>
<!-- 3. Achievements, Schedule, Calendar (ai.js) -->
<script src="/js/ai.js"></script>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PAGE LOADER ‚Äî Fetch and inject HTML partials
   into the page-content-wrapper div at startup.
   This preserves all page IDs (page-dashboard,
   page-habits, etc.) that JS relies on.
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const PAGE_PARTS = [
  "pages/dashboard.html",
  "pages/habits.html",
  "pages/schedule.html",
  "pages/insights.html",
  "pages/ai.html"   /* contains analytics, achievements, calendar, settings */
];

async function loadPagePartials(){
  const wrapper = document.getElementById("page-content-wrapper");
  for(const url of PAGE_PARTS){
    try{
      const res = await fetch(url);
      if(!res.ok) throw new Error(`Failed to load: ${url}`);
      const html = await res.text();
      wrapper.insertAdjacentHTML("beforeend", html);
    } catch(err){
      console.error("Page partial load error:", err);
    }
  }
  // After all partials are injected, wire nav and init app
  initApp();
}

function initApp(){
  // Wire nav item clicks
  document.querySelectorAll(".nav-item").forEach(n => {
    n.addEventListener("click", () => goTo(n.dataset.page));
  });

  // Set current date in navbar
  document.getElementById("pageDate").textContent =
    new Date().toLocaleDateString("en-US", {weekday:"long", year:"numeric", month:"long", day:"numeric"});

  // Create background particles
  createParticles();
  createAuthParticles();

  // Check for existing session
  const savedUser = localStorage.getItem("hab_user");
  if(savedUser){
    try{
      const user = JSON.parse(savedUser);
      window.currentUser = user;
      document.getElementById("auth-screen").classList.add("hidden");
      updateGreeting(user.name);
    } catch(e){
      localStorage.removeItem("hab_user");
    }
  }

  // Auth keyboard shortcuts on password fields
  document.getElementById("login-pass").addEventListener("keydown", e => {
    if(e.key === "Enter") doLogin();
  });
  document.getElementById("reg-pass").addEventListener("keydown", e => {
    if(e.key === "Enter") doRegister();
  });

  // Load data
  loadHabitsFromDB();
  renderSchedule();
  loadSettings();
  renderAchievements();
  loadXP();
  loadPrediction();

  // Restore AI chat history
  const savedChat = localStorage.getItem("aiChat");
  const chatBox = document.getElementById("chat-box");
  if(savedChat && chatBox) chatBox.innerHTML = savedChat;
}

// Kick off partial loading on DOM ready
document.addEventListener("DOMContentLoaded", loadPagePartials);
</script>

</body>
</html>